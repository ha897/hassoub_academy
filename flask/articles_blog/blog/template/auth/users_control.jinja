{% extends "main/base.jinja" %}
{%from "partials/mobal_article.jinja" import modal%}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col shadow-lg p-3 mb-5 bg-body rounded">
      <h3 class="textColor">لائحة المستخدمين</h3>
      <hr />
      <div class="table-responsive">
        <table class="table text-center">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">الصلاحية</th>
              <th scope="col">حاله الاشتراك</th>
              <th scope="col">تاريخ الاشتراك</th>
              <th scope="col">بريد المستخدم</th>
              <th scope="col">اسم المستخدم</th>
              <th scope="col">معرف المستخدم</th>
            </tr>
          </thead>
          {% for user in users_list %}
          <tbody>
            <tr class="align-middle">
              {# 1 #}
              <td>{{loop.index + pagination.skip }}</td>
              {# 2 #}
              <td>
                {% if user.username == 'owner' %}
                <small>المالك</small>
                {% elif user.is_admin == true %}
                {# تقليل الصلاحية #}
                <a href="{{url_for('auth_controller.role_revoke', user_id=user.id)}}"
                  class="btn btn-sm btn-danger m-0 p-1">تخفيض</a>
                {% else %}
                <a href="{{url_for('auth_controller.role_grant', user_id=user.id)}}"
                  class="btn btn-sm btn-success m-0 p-1">ترقية</a>
                {% endif %}
              </td>
              {# 3 #}
              <td>
                {% if user.stripe_customers[0]%}
                {{user.stripe_customers[0] | replace("None", "ينقص مرحلة الدفع") | replace("active","مستمر")}}
                {% else %}
                غير مشترك
                {% endif %}
              </td>
              {# 4 #}
              <td>
                {% if user.stripe_customers[0] %}
                {{ user.stripe_customers[0].subscription_start }}
                {% else %}
                {% endif %}
              </td>
              {# 5 #}
              <td>{{user.email}}</td>
              {# 6 #}
              <td>{{user.username}}</td>
              {# 7 #}
              <td>{{user.id}}</td>
            </tr>
          </tbody>
          {% endfor %}
        </table>
      </div>
    </div>
    <nav aria-label="Page navigation">
      <div class="pagination justify-content-center">
        {{pagination.links}}

      </div>
    </nav>
  </div>
</div>

{% endblock content %}